package ${package};

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.jdo.PersistenceManager;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;







public class  ${className}  extends  AbstractSimpleTemplateServlet{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	
	@Override
	protected String getHtmlTitle() {
		return "${title}";
	}

	@Override
	protected String getBaseTemplateHtmlName() {
		return "${baseTemplate}";
	}

	@Override
	protected String getMainTemplateHtmlName() {
		return "${mainTemplate}";
	}
	

	

	@Override
	protected String createMainHtml(HttpServletRequest request,
			HttpServletResponse response) throws ServletException, IOException {
			PersistenceManager manager=PMF.get().getPersistenceManager();
		
		${dataClassName}Dao dao=new ${dataClassName}Dao(manager);
		
		int page=PageMenuUtil.parsePageNumber(request, "page");
		int pageSize=2;
		
		int start=(page-1)*pageSize;
		
		List<${dataClassName}> datas=dao.getDatas(start, pageSize, "id", false);
		
		StringBuffer rowHtmls=new StringBuffer();
		String template=SimpleTemplateUtils.loadTextFromFile(getServletContext(),"${mainRowTemplate}");
		
		for(${dataClassName} data:datas){
			Map<String,String> map=${dataClassName}Dao.toLabellMap(data);
			
			String html=TemplateUtils.createAdvancedText(template, map);
			rowHtmls.append(html);
		}
		
		dataMap.put("data", rowHtmls.toString());
		
		long count=dao.count();
		
		PageMenuHtmlMaker maker=new PageMenuHtmlMaker("${path}","");
		String pageMenuHtml=maker.createPageMenuHtml(new PagingInfoImpl(page,count,pageSize));
		dataMap.put("pagemenu", pageMenuHtml);
		
		
		String dataHtml=SimpleTemplateUtils.createTextFromFile(getServletContext(), mainTemplateHtml, dataMap);
		return dataHtml;
	}
}